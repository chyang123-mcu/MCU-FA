<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>財報分析智慧看板 | Bauhaus Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;700&family=Montserrat:wght@800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #e0e5ec;
            --nm-light: #ffffff;
            --nm-shadow: #a3b1c6;
            --bauhaus-red: #d9432f;
            --bauhaus-blue: #2d5a9e;
            --bauhaus-yellow: #f2c14e;
            --text-main: #3d4b5f;
            --transition: all 0.4s cubic-bezier(0.165, 0.84, 0.44, 1);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: var(--bg);
            color: var(--text-main);
            display: flex;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Neumorphism Styles */
        .nm-flat {
            background: var(--bg);
            box-shadow: 8px 8px 15px var(--nm-shadow), -8px -8px 15px var(--nm-light);
            border-radius: 20px;
            border: none;
        }
        .nm-inset {
            background: var(--bg);
            box-shadow: inset 6px 6px 12px var(--nm-shadow), inset -6px -6px 12px var(--nm-light);
            border-radius: 15px;
            border: none;
        }
        .btn-active {
            box-shadow: inset 4px 4px 8px var(--nm-shadow), inset -4px -4px 8px var(--nm-light);
            color: var(--bauhaus-blue);
            transform: scale(0.98);
        }

        /* Sidebar Navigation */
        #sidebar {
            width: 280px;
            height: 100vh;
            padding: 40px 25px;
            position: fixed;
            display: flex;
            flex-direction: column;
            z-index: 1000;
            transition: var(--transition);
        }
        .logo {
            font-family: 'Montserrat', sans-serif;
            font-size: 28px;
            line-height: 0.9;
            margin-bottom: 50px;
            padding-left: 10px;
            border-left: 10px solid var(--bauhaus-red);
        }
        .nav-item {
            padding: 18px 20px;
            margin-bottom: 20px;
            cursor: pointer;
            font-weight: 700;
            text-align: left;
            transition: var(--transition);
        }

        /* Main Content */
        main {
            margin-left: 280px;
            padding: 50px;
            width: calc(100% - 280px);
            transition: var(--transition);
        }

        .section { display: none; animation: slideUp 0.6s ease-out; }
        .section.active { display: block; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }

        /* Dashboard Components */
        .card { padding: 30px; margin-bottom: 30px; position: relative; overflow: hidden; }
        .import-zone {
            height: 250px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 2px dashed var(--nm-shadow);
            margin-bottom: 30px;
            cursor: pointer;
        }

        /* Charts Visualization */
        .chart-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }
        .svg-box { width: 100%; height: 250px; display: flex; align-items: center; justify-content: center; }

        /* Knowledge Bubbles */
        .bubble-wall {
            position: relative;
            height: 600px;
            background: var(--bg);
            border-radius: 30px;
            overflow: hidden;
        }
        .bubble {
            position: absolute;
            width: 120px; height: 120px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 15px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: var(--transition);
        }
        .bubble:hover { transform: scale(1.15) rotate(5deg); z-index: 50; }

        /* Notes System */
        #note-panel {
            position: fixed;
            top: 40px;
            right: -320px;
            width: 300px;
            height: calc(100vh - 80px);
            padding: 25px;
            z-index: 999;
            transition: var(--transition);
        }
        #note-panel.open { right: 20px; }
        .note-toggle {
            position: fixed;
            right: 20px;
            bottom: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            z-index: 1001;
        }
        textarea {
            width: 100%; height: 150px;
            margin: 15px 0;
            padding: 15px;
            background: transparent;
            color: var(--text-main);
            resize: none;
        }

        /* RWD & Hamburger */
        .menu-btn { display: none; font-size: 24px; position: fixed; top: 20px; left: 20px; z-index: 1100; padding: 10px; }
        @media (max-width: 1024px) {
            #sidebar { left: -280px; }
            #sidebar.open { left: 0; }
            main { margin-left: 0; width: 100%; padding: 80px 20px; }
            .menu-btn { display: block; }
            .chart-container { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

    <button class="menu-btn nm-flat" onclick="toggleSidebar()">☰</button>

    <nav id="sidebar" class="nm-flat">
        <div class="logo">FINA<br>CANVAS</div>
        <button class="nav-item nm-flat btn-active" onclick="switchTab('home', this)">儀表板匯入</button>
        <button class="nav-item nm-flat" onclick="switchTab('analytics', this)">智慧比率分析</button>
        <button class="nav-item nm-flat" onclick="switchTab('knowledge', this)">關鍵知識點</button>
        <button class="nav-item nm-flat" onclick="switchTab('exam', this)">互動演練</button>
        
        <div style="margin-top: auto; display: grid; gap: 10px;">
            <button class="nm-flat" style="padding: 12px; color: var(--bauhaus-blue); font-weight: bold;" onclick="exportToLocal()">下載分析報告</button>
            <button class="nm-inset" style="padding: 10px; font-size: 12px;" onclick="alert('已串接預留空間，請在程式碼中填入 WebApp URL')">同步至 Google Sheet</button>
        </div>
    </nav>

    <main>
        <section id="home" class="section active">
            <h1 style="margin-bottom: 10px;">財報智慧看板</h1>
            <p style="margin-bottom: 30px; opacity: 0.7;">Bauhaus 功能主義學習系統</p>
            <div class="import-zone nm-inset" onclick="mockImport()">
                <div style="font-size: 40px; color: var(--bauhaus-red);">⊕</div>
                <p style="margin-top: 10px; font-weight: bold;">點擊模擬匯入公司財報</p>
                <small>支援 JSON / CSV 格式範本</small>
            </div>
            <div id="import-status" style="display: none;" class="card nm-flat">
                <h3 id="comp-name">公司名稱：---</h3>
                <p id="comp-info" style="margin-top: 10px;"></p>
            </div>
        </section>

        <section id="analytics" class="section">
            <h2 style="margin-bottom: 30px;">智慧比率分析</h2>
            <div class="chart-container">
                <div class="card nm-flat">
                    <h3>獲利與現金交集 (Venn)</h3>
                    <div class="svg-box">
                        <svg width="240" height="180">
                            <circle cx="90" cy="80" r="60" fill="rgba(217, 67, 47, 0.3)" stroke="var(--bauhaus-red)" stroke-width="2"/>
                            <circle cx="150" cy="80" r="60" fill="rgba(45, 90, 158, 0.3)" stroke="var(--bauhaus-blue)" stroke-width="2"/>
                            <text x="55" y="85" font-size="12" font-weight="bold">高獲利</text>
                            <text x="145" y="85" font-size="12" font-weight="bold">高現金</text>
                        </svg>
                    </div>
                    <p id="venn-desc" style="font-size: 14px; line-height: 1.6;"></p>
                </div>
                <div class="card nm-flat">
                    <h3>損益兩平點分析</h3>
                    <div class="svg-box">
                        <svg width="100%" height="200" viewBox="0 0 300 150">
                            <line x1="20" y1="130" x2="280" y2="130" stroke="#333" stroke-width="2"/> <line x1="20" y1="20" x2="20" y2="130" stroke="#333" stroke-width="2"/> <path d="M 20 120 Q 150 70 280 20" fill="none" stroke="var(--bauhaus-red)" stroke-width="3"/> <line x1="20" y1="80" x2="280" y2="80" stroke="var(--bauhaus-blue)" stroke-width="2" stroke-dasharray="5,5"/> </svg>
                    </div>
                    <p style="font-size: 14px; text-align: center;">紅色：總收益 | 藍色虛線：固定成本</p>
                </div>
            </div>
        </section>

        <section id="knowledge" class="section">
            <h2 style="margin-bottom: 20px;">關鍵知識氣泡</h2>
            <div class="bubble-wall nm-inset" id="bubble-container"></div>
        </section>

        <section id="exam" class="section">
            <h2 style="margin-bottom: 30px;">實戰互動演練</h2>
            <div id="quiz-box" class="card nm-flat">
                <h3 id="q-title" style="margin-bottom: 20px;">問題載入中...</h3>
                <div id="q-options" style="display: grid; gap: 15px;"></div>
            </div>
        </section>
    </main>

    <div id="note-panel" class="nm-flat">
        <h3 style="border-bottom: 3px solid var(--bauhaus-yellow); display: inline-block;">學習心得隨記</h3>
        <textarea id="note-input" class="nm-inset" placeholder="觀察到什麼財報異狀嗎？記錄下來..."></textarea>
        <button class="nm-flat" style="padding: 10px 20px; width: 100%; font-weight: bold; cursor: pointer;" onclick="addNote()">新增筆記</button>
        <div id="note-display" style="margin-top: 20px; overflow-y: auto; max-height: 300px;"></div>
    </div>
    <div class="note-toggle nm-flat" onclick="toggleNotes()">✎</div>

    <script>
        // 1. Data Store
        let financeData = null;
        let notes = JSON.parse(localStorage.getItem('fincanvas_notes')) || [];

        const kPoints = [
            { t: "資產負債表", d: "某個時點公司的財富快照，公式：資產 = 負債 + 股東權益。" },
            { t: "流動比率", d: "流動資產 / 流動負債。衡量公司一年內還債的應變能力，通常 > 200% 為佳。" },
            { t: "ROE", d: "股東權益報酬率。公司用股東的錢賺錢的效率，是巴菲特最看重的指標。" },
            { t: "營業現金流", d: "公司靠本業「實際收到」的現金，比帳面獲利更難造假。" },
            { t: "毛利率", d: "(營收-成本)/營收。代表產品競爭力，越高代表具備技術或品牌護城河。" },
            { t: "EPS", d: "每股盈餘。每一股能賺多少錢，直接影響股價評價。" },
            { t: "速動比率", d: "更嚴苛的償債能力指標，需扣除存貨與預付款項。" },
            { t: "負債比率", d: "總負債 / 總資產。衡量財務槓桿，過高可能在升息循環面臨風險。" },
            { t: "存貨週轉率", d: "貨物賣出的速度。週轉太慢可能代表產品退流行或經營不善。" },
            { t: "應收帳款", d: "客戶還沒給的貨款。週轉率低代表收錢辛苦，有呆帳風險。" },
            { t: "自由現金流", d: "營業現金流扣除資本支出。這是公司真正能拿來發股利或投資的錢。" },
            { t: "損益兩平點", d: "總收入等於總成本的時點。超過此點後公司才開始真正獲利。" },
            { t: "保留盈餘", d: "公司賺了錢沒分給股東，留著繼續投資或應急的資金。" },
            { t: "資本支出", d: "公司購買土地、廠房或升級設備的重大支出。" },
            { t: "業外損益", d: "不靠本業賺的錢，如匯兌損益或賣掉土地，不具備持續性。" },
            { t: "利息保障倍數", d: "衡量獲利夠不夠付貸款利息，銀行放貸的重要參考。" },
            { t: "市盈率 PE", d: "股價 / EPS。代表投資人願意花幾倍價格買入該公司的獲利能力。" },
            { t: "折舊", d: "資產隨時間消耗的價值。雖無現金流出，但在會計上視為費用。" },
            { t: "淨利", d: "營收扣除所有成本、費用及稅金後的最終獲利。" },
            { t: "流動性", d: "資產轉換成現金的速度。現金流動性最強，房地產較弱。" }
        ];

        // 2. Navigation Logic
        function switchTab(id, btn) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('btn-active'));
            document.getElementById(id).classList.add('active');
            btn.classList.add('btn-active');
            if(window.innerWidth <= 1024) toggleSidebar();
        }

        function toggleSidebar() { document.getElementById('sidebar').classList.toggle('open'); }
        function toggleNotes() { document.getElementById('note-panel').classList.toggle('open'); }

        // 3. Mock Data & Analytics
        function mockImport() {
            financeData = {
                name: "趨勢領航股份有限公司 (23XX)",
                roe: 18.5,
                currRatio: 210,
                cashFlow: "正向",
                industryAvg: 14.2
            };
            document.getElementById('import-status').style.display = 'block';
            document.getElementById('comp-name').innerText = `公司名稱：${financeData.name}`;
            document.getElementById('comp-info').innerHTML = `
                匯入分析完畢：<br>
                1. <strong>ROE: ${financeData.roe}%</strong> (優於同業平均 ${financeData.industryAvg}%)<br>
                2. <strong>流動比率: ${financeData.currRatio}%</strong> (償債能力強)<br>
                3. <strong>現金流狀態: ${financeData.cashFlow}</strong>`;
            
            document.getElementById('venn-desc').innerText = `分析：該公司落於「高獲利」與「高現金」的交集區域，代表其盈餘品質極佳，非帳面虛盈。`;
        }

        // 4. Knowledge Bubbles Logic
        function renderBubbles() {
            const container = document.getElementById('bubble-container');
            const colors = ['var(--bauhaus-red)', 'var(--bauhaus-blue)', 'var(--bauhaus-yellow)'];
            kPoints.forEach((p, i) => {
                const b = document.createElement('div');
                b.className = 'bubble nm-flat';
                b.style.left = (Math.random() * 70 + 5) + '%';
                b.style.top = (Math.random() * 70 + 5) + '%';
                b.style.background = colors[i % 3] + '15';
                b.style.border = `2px solid ${colors[i % 3]}44`;
                b.innerHTML = p.t;
                b.onclick = () => alert(`${p.t}\n\n${p.d}`);
                container.appendChild(b);
            });
        }

        // 5. Notes Logic
        function addNote() {
            const input = document.getElementById('note-input');
            if(!input.value) return;
            const newNote = { id: Date.now(), text: input.value, date: new Date().toLocaleTimeString() };
            notes.unshift(newNote);
            localStorage.setItem('fincanvas_notes', JSON.stringify(notes));
            input.value = '';
            renderNotes();
        }

        function renderNotes() {
            const div = document.getElementById('note-display');
            div.innerHTML = notes.map(n => `
                <div class="nm-inset" style="padding:10px; margin-bottom:10px; font-size:13px; position:relative;">
                    <small style="opacity:0.5;">${n.date}</small><br>${n.text}
                    <button onclick="delNote(${n.id})" style="position:absolute; right:5px; top:5px; background:none; border:none; color:var(--bauhaus-red); cursor:pointer;">×</button>
                </div>
            `).join('');
        }
        function delNote(id) {
            notes = notes.filter(n => n.id !== id);
            localStorage.setItem('fincanvas_notes', JSON.stringify(notes));
            renderNotes();
        }

        // 6. Interactive Quiz
        function loadQuiz() {
            const q = {
                title: "小明發現 A 公司的流動比率為 80%，請問這代表什麼經營風險？",
                opts: ["財務非常穩健", "手頭現金過多", "短期內可能面臨還債困難", "產品競爭力太強"],
                ans: 2
            };
            document.getElementById('q-title').innerText = q.title;
            document.getElementById('q-options').innerHTML = q.opts.map((o, i) => `
                <button class="nm-flat" style="padding:15px; text-align:left; cursor:pointer;" onclick="checkAns(${i}, ${q.ans})">${o}</button>
            `).join('');
        }
        function checkAns(i, a) {
            alert(i === a ? "正確！流動比率低於 100% 代表流動負債大於流動資產，短期壓力大。" : "再想一想，流動比率低於 100% 通常不是好事。");
        }

        // 7. Export
        function exportToLocal() {
            const content = `財報分析報告\n公司：${financeData ? financeData.name : '未匯入'}\n\n筆記內容：\n${notes.map(n => `- ${n.text}`).join('\n')}`;
            const blob = new Blob([content], {type: 'text/plain'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = '財報分析成果.txt';
            a.click();
        }

        // Init
        renderBubbles();
        renderNotes();
        loadQuiz();
    </script>
</body>
</html>